---
layout: post
title:  "자바로 배우는 리팩토링 입문"
author: "glqdlt"
---

# 들어가며

이 책은 막연하게 리팩토링을 어떻게 시작해야할지, 현재 재직중인 회사의 코드가 우아한지를 1차원적으로 이해하는 데 도움 주는 입문적인 내용이다. 만약 마틴 파울러의 GOF의 디자인 패턴 책이나 조슈아 블로크의 이팩티브 자바를 읽어본 사람이라면 굳이 읽지 않아도 된다. 책의 챕터 별 각 주제 자체는 나쁘진 않지만 자주 현업에서 사용 되는 실제 대표적인 사례 위주로 접근하다보니 서술한 고전 서적들의 내용 중 일부분만 다루기 때문이다.

그래도 만약 회사에서 공짜로 책을 사주거나, 책꽂이 꽃혀있다면 짬을 내서 읽어봐도 무관하다. 책을 읽으면서 에이 이게뭐야, 이건 자주쓰는 거지, 아 그래 저자가 뭘 좀 아는군 이라며 끄덕이는 자신을 본다면, 당신은 월급만 축내며 살아온 프로그래머는 아님을 느끼며 자아도취 하길 바란다. 고백하자면 나는 자아도취 하고 싶어서 책을 봤다. (기분이 매우 좋았다.)

# 이 책은

GOF 책을 언급했지만, 이 책은 사례 중심이기에 실무에서 실수하는 굉장히 기본적인 내용에 대해서도 나온다. 그래서 아는 내용이 있다면 휙휙 넘기고 이건 처음 보는 데 싶으면 자세히 살펴보고, 추가적으로 구글링 하는 것이 좋다.

개인적으로 책에서 나오는 대부분의 패턴이나 (팩토리 메서드 패턴과 같은), 메소드의 커뮤니케이션을 에러 Exception 으로 소통하는 것에 대해서는 기본 자바 서적(예를 들면 이펙티브 자바라던지)에도 자주 중복되는 기본적인 내용이어서 쉽게 넘겼다. 어셔선 도입이나 널 객체 도입에 대해서는 크게 공감이 되질 않았는 데, 자바8의 Optional 이 생겼다 보니 크게 와닿지 않았다.

인상깊었던 부분은 관측 데이터 복제(옵저버 패턴) 부분이 기억에 남는다. 옵저버 패턴은 개인적으로 자바 서버 사이드 보다는 javascript 클라이언트 사이드에서 많이 접했었는 데, 책에서는 자바 SWING 을 예시로 들다 보니 여러가지 생각이 많이 들었다. 

그나마 실무에서 공감이 될만한 것으로는 분류 코드를 하위 클래스로 치환이 많은 도움이 될 거라 본다. 우리 회사도 마찬가지만 대부분 기술 부채가 있는 회사의 실무 코드를 보면 단일 책임 원칙을 위반한 경우가 많다. 

예를 들어 특정 스키마에 N개 이상의 레코드가 들어간다던지, 특정 필드의 TYPE 으로 레코드를 분류하거나, 자바 웹 어플리케이션에서도 특정 FORM 의 입력 파라미터가 데이터의 타입을 결정하는 경우를 대표적으로 들 수 있다. 

이 경우 여러 컴포넌트의 레이어에서 계속해서 다중 if 나 switch 문을 통해 데이터의 타입에 따른 로직을 결정하는 코드를 자주 볼 것이다. 이에 대해 저자는 책의 절반 이상을 이 주제로 리팩토링을 다룬다. 

이 챕터에서 가장 흥미로운 것은 sub type 자신이 상태코드를 갖는 식으로 처리하는 관점도 재밌었는 데, 이는 아래에서 실제 다루었던 실무 코드 일부를 설명하면서 이야기 하겠다.

<img src="/images/gift_class_diagram.png">

현재 재직 중인 곳은 게임 서비스 회사인데, 운영자가 특정 유저에게 아이템이나 재화를 선물할 수 있는 기능이 있다. 문제는 선물하는 스키마는 단 하나이고, 이 스키마에 아이템, 재화, 심지어 최근에 생긴 인벤토리용 아이템 모든 것이 다 선물이 된다. SOLID 창시자인 로버트 마틴이 보면 뒷목을 잡을 듯하다.


데이터 타입이 무엇인지 자기가 어떠한 성격인지를 sub type 스스로가 설명하게 하기 위해 팩토리 메서드 패턴으로 처리했다. 
위에서도 언급했지만 특이한 것은 Sub type 자신이 어떠한 코드인지를 알고 있다는 점이다.


# 마무리

책 자체는 리팩토링에 흥미를 위한 실무 사례 위주의 입문 서적이다. 이 책을 통해 무엇을 깨우친다기 보다는, 얼마나 내가 우아한 코드를 작성하고 있었는 지 또는 이 코드가 상상을 초월하는 냄새가 나는 코드인지를 1차원적으로 접근해볼 수 있다. 
 

