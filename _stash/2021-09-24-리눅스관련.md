
## 리눅스의 권한

리눅스는 기본적으로 다중 사용자를 고려해서 만들어진 OS 이다. 사용자는 고유한 계정을 받아서 OS에 로그인하게 된다. 계정은 논리적으로 묶어서 그룹을 만들수있다.

###  파일 접근 권한

리눅스 파일 시스템은 각 파일에 대해 사용 권한이 있다. 기본적으로 파일에는 소유권과 허가권 2가지의 개념이 있다.
아래와 같은 구성이 있다고 하자. 아래는 나의 라즈베리파이 pi 계정의 계정의 HOME 위치이다.

```
pi@raspberrypi:~ $ pwd
/home/pi
pi@raspberrypi:~ $ ls -l
total 45512
drwxr-xr-x 2 pi pigroup     4096 Mar  5  2021 Bookshelf
drwxr-xr-x 2 pi pigroup     4096 Mar  5  2021 Desktop
drwxr-xr-x 2 pi pigroup     4096 Mar  5  2021 Documents
drwxr-xr-x 2 pi pigroup     4096 May 14 09:50 Downloads
drwxr-xr-x 2 pi pigroup     4096 Mar  5  2021 Music
drwxr-xr-x 2 pi pigroup     4096 Mar  5  2021 Pictures
drwxr-xr-x 2 pi pigroup     4096 Mar  5  2021 Public
```

여기서 Downloads 폴더를 살펴보면, Downloads 라는 파일(사실은 폴더다)에 여러가지 설명이 붙어있다. drw.. pi pi 등등

```
drwxr-xr-x 2 pi pigroup     4096 May 14 09:50 Downloads
```

#### 소유권

```
drwxr-xr-x 2 (( pi pigroup ))     4096 May 14 09:50 Downloads
```

위에서 소유권은 (()) 로 구분한, pi pi 부분이 소유권이다. 첫번째 pi 는 소유자 이름이고, 두번째 pigroup 는 그룹 이름이다.

즉 pi 란 계정이 소유하고 있으며, pigroup 라는 그룹이 소유하고 있다는 의미가 된다. 

소유권의 변환은 아래의 명령 커맨드인 chown 으로 한다.

```
> chown pi:pigroup Downloads
```

#### 허가권

```
(( drwxr-xr-- )) 2 pi pigroup     4096 May 14 09:50 Downloads
```

허가권은 한마디로 말하면 접근 정책을 말한다. 위에서 (()) 로 구분한  drwxr-xr-x  가 된다.

기본적으로 위 표기는 특별한 패턴을 가진다. 10글자가 연속으로 되어있지만 패턴이 있다. 개미의 몸뚱이와 같다.


1 글자는 파일의 종류를 의미한다. 파일의 종류는 폴더는 d 로 표기하고, 파일은 - 로 표기한다. 심볼릭 링크는 l로 표현된다. 아래의 경우 d 임으로 이 Downloads는 폴더란 걸 알수 있다. 
 
 ```
 (( d )) rwxr-xr--
 ```
 
2~4 글자는 소유자의 권한을 의미한다. 읽기는 r 쓰기는 w 실행은 x로 표현이 된다. 즉 아래의 예시에는 pi 라는 계정은 읽기 r, 쓰기 w, 실행 x 모두할수 있음을 의미한다.

 ```
 d((rwx))r-xr--
 ```

5~7 글자는 그룹의 권한을 의미한다.읽기는 r 쓰기는 w 실행은 x로 표현이 된다. 불가능한 것은 - 로 작성한다. 즉 아래의 예시에는 pigroup 라는 그룹은 읽기 r, 실행 x 만 할수 있음을 의미한다.

 ```
 d rwx((r-x))r--
 ```
8~10 글자는 그 외 사용자의 권한을 의미한다.읽기는 r 쓰기는 w 실행은 x로 표현이 된다. 불가능한 것은 - 로 작성한다. 즉 아래의 예시에는 pi 와 pigroup 그룹 외의 사용자는 그룹은 읽기 r 만 할수 있음을 의미한다.


 ```
 drwxr-x((r--))
 ```

##### 허가권의 부여와 변경

허가권의 변경 명령어는 chmod 로 한다.

```
> chmod -Rf 777 Downloads
drwxrwxrwx 2 pi pi     4096 May 14 09:50 Downloads
``` 

여기서 777이란 옵션을 주목해야한다. 777 이 연속된 3글자도 역시 패턴을 가지고 있다. 

첫번째 글자는 사용자에 대한 권한이고, 두번째 글자는 그룹에 대한 권한, 세번째 글자는 이 외의 사용자에 대한 권한이다.

7이란 숫자는 뭘까?  아래의 표에 의해 더해진 값을 말한다. 777은 사용자,그룹,그외의 사용자 모두가 read,write,execute 를 할수 있음을 말한다.

|키|값|의미|
|---|---|---|
|r|4|read|
|w|2|write|
|x|1|execute|
|-|0|null|

d,rwx,rwx,rwx 란 권한을 놓고보면 쉽다. d는 폴더를 의미하고, rwx 는 위 표에 대칭되는 값을 숫자로 나열해서 더하면 4 + 2+ 1 = 7 의 값을 가진다. 즉 7 은 read, write, execute 가 모두 합쳐진 숫자이다.

-,r--,-wx,--x 이번에는 이걸 가지고 해보자. 첫글자가 - 임으로 이는 파일을 의미한다. 소유자는 r-- 의 권한을 갖고 있는데, 4 + 0 + 0 = 4의 권한이 부여되었으며, 그룹에서는 -wx 임으로, 0+2+1 = 3 이 된다. 마지막으로 그 외의 사용자에서는 --x 임으로 0 + 0+ 1 = 1 이 된다. 즉 위 권한은 431 의 권한을 갖게 된다.

431 권한으로 권한을 부여하는 명령어는 아래이다.

```
> chmod 431 some_file
-r---wx--x 2 pi pi     4096 May 14 09:50 some_file
```

### 2 라는 숫자의 의미

```
drwxr-xr-x 2 pi pigroup     4096 May 14 09:50 Downloads
```

에서 아래처럼 2라는 숫자의 의미가 궁금할것이다. 이는 하드링크의 갯수를 말한다. 2라는 숫자는 하드링크가 2개 있음을 말한다.

```
drwxr-xr-x ((2)) pi pigroup     4096 May 14 09:50 Downloads
``` 

#### 하드링크와 심볼릭링크

심볼릭링크는 윈도우의 바로가기 와 비슷한 개념이다. 특정 파일을 논리적으로 가르키는 바로가기 파일을 의미한다.
 심볼릭링크는 참조하는 대상이 삭제되면 무용지물이 된다.
 
 하드링크는 대상 파일이 참조하는 실제 물리적인 디스크 블록을 가르킨다. 심볼릭링크와 개념이 비슷하지만 절대적으로 다른 것이 하드링크는 참조하는 대상이 삭제되어도 무용지물이 되지 않는다. 왜냐면 참조하는 대상이 가르키고 있는 디스크 블록을 가르키는 것이기 때문이다.  