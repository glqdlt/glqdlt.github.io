# RestfulAPI 설계

이 글은 Naver Deview 2017 의 '그런 REST API로 괜찮겠는가?' 세션을 보고 난 후 자극을 받아서 작성하게 되었습니다.

아래 글에서 말하는 API 는 RestfulAPI 를 줄여서 설명한 것이고, 웹 개발자에게 있어 API 란 Restful API를 일반적으로 칭하는 관례 때문입니다.

## URL

RestfulAPI는 HTTP 프로토콜 위에서 설계되는 웹 서비스 인터페이스입니다. API 를 사용하는 데에 어떠한 API를 사용할지에 대한 URL 정의가 필요합니다. 여기서는 URL 이 어떠한 사전적인 의미를 가지는 지를 설명합니다.

### URL 이란

URL이란 Uniform Resource Locator 의 약자이다. 동의어로 URI (Uniform Resource Identifier) 가 있습니다. URL은 지시자이고, URI 는 구분자라는 의미로 해석할수 있는데, URL은 어떠한 리소스를 접근하는 데 목적을 두고, URI는 어떠한 리소스를 구별하는 데에 목적을 둡니다. 서로 결론적으로 같은 의미로 해석을 할수 있습니다.

### URL의 구성

URL은 개미의 몸통처럼 3가지 파트로 스킴, 호스트, 패스로 나눌수 있습니다.

아래 URL 을 3가지 파트로 나누면 아래와 같습니다.

> https://www.google.com/

- URL
    - Scheme
        - https
    - Host
        - www.google.com
    - Path
        - /

#### 스킴
스킴은 어떠한 프로토콜을 사용할 것인지에 대한 명시입니다. 스킴은 어떻게 접근할지에 대한 'how' 에 해당하며, 위에서는 https 를 사용한다고 기재되었습니다. 

스킴은 대소문자를 구분하지 않습니다. 대표적으로 http, mailto, ftp, ssh 등이 있습니다. 

#### 호스트
호스트는 서버 주소를 의미합니다. 호스트는 어디에 접근할지에 대한 'where'에 해당하며, 위에서는 www.google.com 이란 이름의 도메인주소(DNS) 로 기재되었습니다, IP를 기재할수있으며, PORT 도 기재할수 있습니다.

#### 패스
패스는 호스트의 특정 경로를 의미하며, 'what' 에 해당합니다. 위 예시에서는 / 루트임으로 첫 진입점을 의미합니다.   
    
   

## URL 디자인

### Path variable vs Query Parameter

특정 유저의 정보를 조회하는 API 를 설계해야한다면 아래 2가지 방법으로 접근해볼 수 있습니다.

Case A)
> (GET) /api/user/abc

Case B)
> (GET) /api/user?id=abc

2개의 차이점은 무엇일까?

첫번쨰 케이스는 abc 라는 유저가 존재하지 않으면 404 을 응답합니다. 반면 두번쨰 케이스는 400이거나 404 또는 200 으로 응답이 될 수 있습니다.

이 말의 의미는 두 차이는 리소스가 무조건 있다를 가정하거나 아니거나의 차이에 따른 것입니다.

케이스 A는 물리적인 리소스의 접근을 의미합니다. 반면 케이스 B는 리소스의 탐색(검색)을 의미합니다.

패스 변수의 경우 사실 리소스 경로를 선언식 방법(다른 말로 하드코딩)에서 가변식으로 바꾼 개념일 뿐입니다. 즉 user 아이디가 abc인 계정이 존재하지 않는 경우를 가정하지 않는 개념이기에 무조건 에러 응답이 반환되어야 합니다. 

쿼리 파라미터의 경우, 이름에도 나타나듯 리소스에 대한 질의(Query)를 하는 개념입니다. DB 기반 웹 프로그래밍이 익숙한 사람들의 경험으로 보면, SQL 로 어떠한 조회를 할 떄, 데이터가 없다고 해서 에러가 발생하는 경우를 본적이 있나요? 그와 같은 이치입니다.

쿼리 파라미터는 해당 리소스에 옵션을 적용하겠다는 의미일 뿐입니다. 옵션을 적용하지 않아도 리소스에 대한 접근은 가능해야합니다. 

예를 들어서 아래와 같이 쿼리 파라미터 없이 접근할때에는 서비스 정상 응답이나 적절한 가이드 안내가 필요합니다.

> (GET) /api/user

### #의 의미


```#```은 URI_Fragment 라고 하며, 앵커라고 부르기도 합니다. 앵커는 특수한 의미를 가집니다. 현재 위치의 리소스의 어떠한 섹션(또는 주석)으로 접근하겠다는 의미입니다. 본래 HTTP가 논문을 공유하기 위해 만들어진 것이기에 이를 생각해보면 쉽습니다. 예를 들어서 아래와 같은 경우는 guide 라는 웹페이지의 챕터2 항목으로 이동합니다.

> (GET) /docs/guide#charpter_2

## 기본적인 헤더

HTTP 프로토콜에는 여러가지 헤더가 존재합니다. 비공식 헤더를 추가할수도 있으며, 이에 따른 구분자로 'X-' 접두어를 붙이는 관례도 있습니다.

### Request URL

말그대로 접근하려는 URL을 의미합니다.

### Request Method

접근하려는 URL 은 Method 에 따라 다르게 응답될수 있습니다. 객체지향프로그래밍으로 치면 다형성에 해당합니다. 예를 들어서 아래와 같은 똑같은 URL 의 API가 있다고 하더라도 각기 다르게 수행될수 있습니다. 대표적으로 HEADER, GET,  POST, PUT, FATCh, DELETE 가 있습니다. 

> (GET) /user

> (POST) /user



#### POST

POST 는 리소스를 새로 생성하는 메소드입니다. 즉 여러번 호출하면 각기 다른 객체가 만들어집니다. new 키워드를 통해 어떠한 객체를 생성한 개념과 같습니다.


요청 

> (POST) /user

결과
> 200 // User newUser = new User 

#### PUT

PUT 은 이미 만들어졌던 기존 리소스 경로를 새로운 리소스로 덮어씌우는 것을 말합니다. 프로그래밍 적으로 보면 객체 참조 주소를 바꾸는 개념입니다.
 
교체할 리소스가 존재해야하고, 해당 객체는 PUT 을 통해 연결되는 객체로 바뀌게 됩니다.

PATCH 와 다르게 객체 일부를 변경하는 것이 아닌, 객체 자체를 바꾸는 것이기 때문에 멱등성입니다.


#### PATCH 

PATCH 는 이미 만들어졌던 기존 객체의 특정한 속성을 바꾸는 것을 말합니다.  PUT 은 기존 객체의 참조 주소 자체를 바꾸기에 전체를 바꾸는 것과 같으며, PATCH는 일부만을 바꾸는 개념입니다.

PATCH 는 PUT에 가까울 정도로 모든 속성을 교체한다면 멱등성을 가집니다. 다만, 일부만을 바꾸는 경우 멱등성을 보장하지 않습니다.

유저 A 는 setUserName() 을 호출하여 이름을 바꾸었던 반면, 유저 B는 setUserId() 를 호출하여 아이디를 바꾸는 PATCH 작업이 동시에 일어날 경우를 생각해보십시오.


## 기본적인 상태 코드

서버에서 요청한 처리에 대한 결과를 의미합니다. 요청에 따라 어떻게 처리되었는지 (에러인지 실패인지)를 나타냅니다.

아래는 작성자가 주로 사용한 코드에 대해서만 작성합니다. 더 자세한 내용은 파이어폭스 개발진에서 잘 정리한 문서(https://developer.mozilla.org/ko/docs/Web/HTTP/Status)가 있음으로 자세한 것은 이로 대체합니다.

### 2xx

### 3xx

### 4xx

### 5xx

# reference

https://tools.ietf.org/html/rfc6570#section-3.1
