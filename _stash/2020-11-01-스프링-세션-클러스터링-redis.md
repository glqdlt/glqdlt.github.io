

SSO 프로젝트에서 

스프링 세션 클러스터링을 분석했던 내용을 적어본다.

TODO: 아마 이 글 어딘가에 있는 클래스 모델도 이곳으로 옮겨야한다.



## REDIS 스키마 구조 분석

redis는 key:value 유형의 nosql 이다. 스키마라는 표현이 정확할지 모르겠지만, 현재 지식이 부족한 터이니 스키마라고 하겠다.

spring-session-redis 를 사용해보면, redis에 아래처럼 저장이 된다.

![](.2020-11-01-스프링-세션-클러스터링-redis_images/907d7b35.png)

크게 굵직하게 생성되는 네임스페이스KEY는 아래와 같다. 

네임스페이스KEY는 뭘까? 일반적으로 KEY 라고 하면 어떠한 값을 가르키는 필드명을 말한다. 네임스페이스KEY란 이해를 쉽게하기 위해 필자가 말한 의미로.
어떠한 목적을 수행하는 키의 집합(같은 prefix를 가지는 key들)을 말한다. redis 의 특징에 따른 메카니즘인지는 모르겠지만, 키를 검색하기 위해서 생기는 일종의 유형이다.

네임스페이스KEY는 아래 예시 기준으로는 user.id 이다.실제 key에 해당하는 것들은 user.id.1 과 user.id.2 이다.

- user.id.1
- user.id.2
- user.id.3 

URL 의 path variable 이라는 개념으로 빗대어 보면, user.id.{id} 라고 표기할수도 있다.

이는 key value 스토리지 특징상, key 기반으로 검색되는 기반에 의거한 형태라고 생각한다.

예를 들어서 rdbms 에서 query 를 통해서는 user의 id 가 1번인 사용자를 검색한다면 아래처럼 된다.

'user 라는 테이블에서 id 라는 필드가 1인 레코드를 쿼리하겠다'

``` select * from user where id = 1;``` 

그런데 redis 메카니즘을 특징으로 인덱싱 검색을 해야한다면 아래처럼 된다.

'user.id.1 이라는 키가 존재하는가?'

``` find key 'user.id.1' ? ```

redis 와 같은 key value 스토리지는 기본적으로 key 가 존재해야 사용이 가능한 구성이다.

이 차이를 이해해야, 스프링 세션이 redis 에 저장되는 자료구조를 이해할수 있다.

또한 스프링 세션에 사용되는 스키마의 값은 대다수 binary 유형이고, 자바의 직렬화 이진 데이터를 사용한다. 보통 Json 이나 xml 과 같은 범용 직렬화 값을 떠올릴수 있지만, 자바의 다양한 상속 구성의 객체를 복호화하기 어려울 때가 많기 때문에 자바 직렬화를 사용한다.


### 스프링 세션 KEY 

스프링 세션에서는 네임스페이스 KEY 를 아래처럼 총 4개를 사용한다.

- spring.session.expirations
- spring.session.index
- spring.session.sessions
- spring.session.expires



#### spring.session.expirations

이 네임스페이스는 유효 시간이 지난 세션을 제거하는 스케줄러를 위한 일종의 큐와 같은 네임스페이스이다.

네임스페이스의 패턴은 네임스페이스:{만료시간} 으로 되어있다.

- (namespace) spring.session.expirations
    - (key) spring:session:expirations:1625813340000
        - (value:binary) \xAC\xED\x00\x05t\x00,expires:f14f10d2-4c9a-4e6a-91ec-f84bd693670b
    - (key) spring:session:expirations:1625813340000
        - (value:binary) \xAC\xED\x00\x05t\x00,expires:f14f10d2-4c9a-4e6a-91ec-f84bd693670b

위 데이터 중에서 spring:session:expirations:1625813340000 라는 키를 보면  1625813340000 시각에 제거해야할 세션 f14f10d2-4c9a-4e6a-91ec-f84bd693670b 이 있음을 나타낸다.

#### spring.session.index

이 네임스페이스는 스프링 시큐리티에서 자격증명의 이름으로 검색할때 세션을 찾기 위한 용도의 인덱스이다.

자격증명(prinicpal) 은 여러가지 수단이 될수 있는 데, 사용자 아이디 이거나 사용자 실명, 또는 어떠한 난수, 어떠한 토큰 명 일 수 있다.


- (namespace) spring:session:index
    - (key) spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:jhun    
        - (value:binary) \xAC\xED\x00\x05t\x00$f14f10d2-4c9a-4e6a-91ec-f84bd693670b
        
위 데이터를 보면 jhun 이라는 자격증명을 가진 사람의 세션은 f14f10d2-4c9a-4e6a-91ec-f84bd693670b 를 나타냄을 알수 있다.

#### spring.session.sessions

세션이라는 개념이 저장되는 공간이다. 다른 네임스페이스 key들은 모두 이 네임스페이스를 참조한다.
네임스페이스의 패턴은 spring:session:sessions:{세션ID} 로 저장이 된다.

이 키의 값은 hash 이고, 세션에 담기는 여러가지 사용자 데이터가 담긴다. 최초 세션이 생성된 시각, 마지막 접근 시각, 세션을 사용하는 다른 모듈들이 추가하는 속성들..

- spring:session:sessions:f14f10d2-4c9a-4e6a-91ec-f84bd693670b

    - (value:hash) 
        - maxInactiveInterval = \xAC\xED\x00\x05sr\x00\x11java.lang.Integer\x12\xE2\xA0\xA4\xF7\x81\x878\x02\x00\x01I\x00\x05valuexr\x00\x10java.lang.Number\x86\xAC\x95\x1D\x0B\x94\xE0\x8B\x02\x00\x00xp\x00\x00\x07\x08
        - creationTime = \xAC\xED\x00\x05sr\x00\x0Ejava.lang.Long;\x8B\xE4\x90\xCC\x8F#\xDF\x02\x00\x01J\x00\x05valuexr\x00\x10java.lang.Number\x86\xAC\x95\x1D\x0B\x94\xE0\x8B\x02\x00\x00xp\x00\x00\x01z\x89\xEB4\x07
        - lastAccessedTime = \xAC\xED\x00\x05sr\x00\x0Ejava.lang.Long;\x8B\xE4\x90\xCC\x8F#\xDF\x02\x00\x01J\x00\x05valuexr\x00\x10java.lang.Number\x86\xAC\x95\x1D\x0B\x94\xE0\x8B\x02\x00\x00xp\x00\x00\x01z\x89\xF4.M
        - sessionAttr:SPRING_SECURITY_CONTEXT = \xAC\xED\x00\x05sr\x00=org.springframework.security.core.context.SecurityContextImpl\x00\x00\x00\x00\x00\x00\x02\x08\x02\x00\x01L\x00\x0Eauthenticationt\x002Lorg/springframework/security/core/Authentication;xpsr\x00Oorg.springframework.security.authentication.UsernamePasswordAuthenticationToken\x00\x00\x00\x00\x00\x00\x02\x08\x02\x00\x02L\x00\x0Bcredentialst\x00\x12Ljava/lang/Object;L\x00\x09principalq\x00~\x00\x04xr\x00Gorg.springframework.security.authentication.AbstractAuthenticationToken\xD3\xAA(~nGd\x0E\x02\x00\x03Z\x00\x0DauthenticatedL\x00\x0Bauthoritiest\x00\x16Ljava/util/Collection;L\x00\x07detailsq\x00~\x00\x04xp\x01sr\x00&java.util.Collections$UnmodifiableList\xFC\x0F%1\xB5\xEC\x8E\x10\x02\x00\x01L\x00\x04listt\x00\x10Ljava/util/List;xr\x00,java.util.Collections$UnmodifiableCollection\x19B\x00\x80\xCB^\xF7\x1E\x02\x00\x01L\x00\x01cq\x00~\x00\x06xpsr\x00\x13java.util.ArrayListx\x81\xD2\x1D\x99\xC7a\x9D\x03\x00\x01I\x00\x04sizexp\x00\x00\x00\x0Ew\x04\x00\x00\x00\x0Esr\x00(com.mycomp.myauth.core.authority.ZempotRoleu\xAB\xE9\xDF\xD7Cfr\x02\x00\x01L\x00\x04rolet\x00\x12Ljava/lang/String;xr\x00-com.mycomp.myauth.core.authority.AuthorityEntity\xEB\xC1\x0FIJ~a\x06\x02\x00\x04L\x00\x0EcatalogSupportt\x00\x13Ljava/lang/Boolean;L\x00\x0DcontextEntityt\x00+Lcom/zempot/tes/core/context/ContextEntity;L\x00\x0Bdescriptionq\x00~\x00\x0FL\x00\x08identityt\x00\x13Ljava/lang/Integer;xpsr\x00\x11java.lang.Boolean\xCD r\x80\xD5\x9C\xFA\xEE\x02\x00\x01Z\x00\x05valuexp\x00sr\x00=com.mycomp.myauth.core.context.ContextEntity$SimpleContextEntityG\x096&~n;\x81\x02\x00\x00xr\x00)com.mycomp.myauth.core.context.ContextEntity\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x03L\x00\x0Bdescriptionq\x00~\x00\x0FL\x00\x02idq\x00~\x00\x13L\x00\x04nameq\x00~\x00\x0Fxpt\x00\x10TES \xEA\xB4\x80\xEB\xA6\xAC ADMINsr\x00\x11java.lang.Integer\x12\xE2\xA0\xA4\xF7\x81\x878\x02\x00\x01I\x00\x05valuexr\x00\x10java.lang.Number\x86\xAC\x95\x1D\x0B\x94\xE0\x8B\x02\x00\x00xp\x00\x00\x00\x0Dt\x00\x03test\x00\x16TES:\xEC\x8B\x9C\xEC\x8A\xA4\xED\x85\x9C\xEA\xB4\x80\xEB\xA6\xAC\xEC\x9E\x90sq\x00~\x00\x1B\x00\x00\x00\x14t\x00\x06systemsr\x00<com.mycomp.myauth.core.authority.SSOAdminContextAuthorityEntity\xCFU\x83K\x92+(!\x02\x00\x01L\x00\x0DtargetContextt\x003Lcom/zempot/tes/core/context/TesAdminContextEntity;xq\x00~\x00\x10q\x00~\x00\x16q\x00~\x00\x19t\x00\x16TES:\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4CMSsq\x00~\x00\x1B\x00\x00\x00\x0Asr\x001com.mycomp.myauth.core.context.TesAdminContextEntity\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x03L\x00\x0DcontextEntityq\x00~\x00\x12L\x00\x0BdisplayTextq\x00~\x00\x0FL\x00\x02idq\x00~\x00\x13xpsq\x00~\x00\x17t\x00\x12\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4CMSsq\x00~\x00\x1B\x00\x00\x00\x0Bt\x00\x07mop_cmst\x00\x12\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4CMSq\x00~\x00+sq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x18TES:EPOCH\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4q\x00~\x00\x1Dsq\x00~\x00'sr\x00:com.mycomp.myauth.core.context.ContextEntity$SubContextEntity\x03\xB2\xA3\x14\xEC\xD6\xA9\xAD\x02\x00\x01L\x00\x0BrootContextq\x00~\x00\x12xq\x00~\x00\x18t\x00\x15epoch:\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4sq\x00~\x00\x1B\x00\x00\x00\x05t\x00\x09epoch_mopsq\x00~\x00\x17t\x00\x09EPOCH CMSsq\x00~\x00\x1B\x00\x00\x00\x07t\x00\x05epocht\x00\x15EPOCH_\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4q\x00~\x004sq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x12TES:EPOCH\xEC\xB9\xB4\xEC\xA7\x80\xEB\x85\xB8sq\x00~\x00\x1B\x00\x00\x00\x0Esq\x00~\x00'sq\x00~\x001t\x00\x0Cepoch:\xEC\x8A\xAC\xEB\xA1\xAFsq\x00~\x00\x1B\x00\x00\x00\x06t\x00\x0Aepoch_slotq\x00~\x006t\x00\x15EPOCH_\xEA\xB8\x80\xEB\xA1\x9C\xEB\xB2\x8C\xEC\x8A\xAC\xEB\xA1\xAFq\x00~\x00Asq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x14TES:WINGER_\xEA\xB3\xA0\xEC\x8A\xA4\xED\x86\xB1sq\x00~\x00\x1B\x00\x00\x00\x10sq\x00~\x00'sq\x00~\x001t\x00\x12\xEC\x9C\x88\xEC\xA0\x80:PC\xEA\xB3\xA0\xEC\x8A\xA4\xED\x86\xB1sq\x00~\x00\x1B\x00\x00\x00\x03t\x00\x0Dwinger_gostopsq\x00~\x00\x17t\x00\x06\xEC\x9C\x88\xEC\xA0\x80sq\x00~\x00\x1B\x00\x00\x00\x01t\x00\x06wingert\x00\x10WINGER_\xEA\xB3\xA0\xEC\x8A\xA4\xED\x86\xB1q\x00~\x00Jsq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x16TES:\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xEB\xA7\x9E\xEA\xB3\xA0CMSsq\x00~\x00\x1B\x00\x00\x00\x0Csq\x00~\x00'sq\x00~\x00\x17t\x00\x15\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xEA\xB3\xA0\xEC\x8A\xA4\xED\x86\xB1CMSq\x00~\x00St\x00\x07mog_cmst\x00\x12\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xEB\xA7\x9E\xEA\xB3\xA0CMSq\x00~\x00Ssq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x11TES:WINGER_\xED\x8F\xAC\xEC\xBB\xA4sq\x00~\x00\x1B\x00\x00\x00\x0Fsq\x00~\x00'sq\x00~\x001t\x00\x0F\xEC\x9C\x88\xEC\xA0\x80:PC\xED\x8F\xAC\xEC\xBB\xA4sq\x00~\x00\x1B\x00\x00\x00\x02t\x00\x0Cwinger_pokerq\x00~\x00Lt\x00\x0DWINGER_\xED\x8F\xAC\xEC\xBB\xA4q\x00~\x00_sr\x00-com.mycomp.myauth.core.authority.SimpleAuthority\x01\x9D[\xE9\x9C\xFE\x9Dt\x02\x00\x03L\x00\x04authq\x00~\x00\x0FL\x00\x07projectq\x00~\x00\x0FL\x00\x07serviceq\x00~\x00\x0Fxq\x00~\x00\x10sq\x00~\x00\x15\x01q\x00~\x00]t\x00\x0F\xEC\x9C\x88\xEC\xA0\x80pokerUsersq\x00~\x00\x1B\x00\x00\x00\x11t\x00\x09pokerUserppsq\x00~\x00bq\x00~\x00\x16q\x00~\x00]t\x00\x0E\xEC\x9C\x88\xEC\xA0\x80pcpUsdersq\x00~\x00\x1B\x00\x00\x00\x15t\x00\x08pcp_userppsr\x00-com.mycomp.myauth.core.authority.LegacyAuthority\xCBqA\x12\x8D;)$\x02\x00\x03L\x00\x07projectq\x00~\x00\x0FL\x00\x04roleq\x00~\x00\x0FL\x00\x07serviceq\x00~\x00\x0Fxq\x00~\x00\x10q\x00~\x00\x16q\x00~\x00)t\x00#\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4 \xEC\x9D\xBC\xEB\xB0\x98\xEC\x9C\xA0\xEC\xA0\x80 \xEA\xB6\x8C\xED\x95\x9Csq\x00~\x00\x1B\x00\x00\x00\x16t\x00\x03NMPt\x00\x04USERt\x00\x03CMSsq\x00~\x00lq\x00~\x00\x16q\x00~\x00)t\x00 \xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4 \xEA\xB4\x80\xEB\xA6\xAC\xEC\x9E\x90 \xEA\xB6\x8C\xED\x95\x9Csq\x00~\x00\x1B\x00\x00\x00\x18t\x00\x03NMPt\x00\x05ADMINt\x00\x03CMSsq\x00~\x00bq\x00~\x00\x16q\x00~\x00)t\x00&\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4 \xEA\xB3\xA0\xEA\xB8\x89\xEA\xB4\x80\xEB\xA6\xAC\xEC\x9E\x90 \xEA\xB6\x8C\xED\x95\x9Csq\x00~\x00\x1B\x00\x00\x00\x19t\x00\x14NMP_CMS_ADMIN_MASTERppsq\x00~\x00bq\x00~\x00\x16sq\x00~\x00\x17t\x00\x15\xED\x85\x9C\xED\x94\x8C\xEB\xA6\xBF\xED\x94\x84\xEB\xA1\x9C\xEC\xA0\x9D\xED\x8A\xB8q\x00~\x00 t\x00\x08templatet\x00\x0D\xED\x83\xAC\xED\x94\x8C\xEB\xA6\xBFUSERsq\x00~\x00\x1B\x00\x00\x00\x1At\x00\x04userppsq\x00~\x00bq\x00~\x00\x16q\x00~\x002t\x00\x10EPOCH CMS \xEA\xB6\x8C\xED\x95\x9Csq\x00~\x00\x1B\x00\x00\x00\x1Ct\x00\x0Bmpoker_userppxq\x00~\x00\x0Dsr\x00Horg.springframework.security.web.authentication.WebAuthenticationDetails\x00\x00\x00\x00\x00\x00\x02\x08\x02\x00\x02L\x00\x0DremoteAddressq\x00~\x00\x0FL\x00\x09sessionIdq\x00~\x00\x0Fxpt\x00\x0F0:0:0:0:0:0:0:1pt\x00\x04jhunq\x00~\x00\x8B


maxInactiveInterval

세션을 사용할수 있는 최대허용 시간 설정 정보이다. 일반적으로 세션타임아웃이라고 하는 개념이다. 예를 들어 30분, 1시간, 2시간

creationTime

최초 세션이 만들어진 시간이다. 

lastAccessedTime

마지막으로 세션이 활성화 된 시간을 말한다. 활성화 되는 기준은 http request 가 발생했을 때 갱신이 된다.


sessionAttr:{모듈명}

세션에 추가적으로 담을 속성들을 말한다. 키의 약자는 Session Attribute 이다. 이 키의 라이프사이클을 책임지는 것은 각 모듈들이다.

sessionAttr:SPRING_SECURITY_CONTEXT = \xAC\xED\x00\x05sr\x00=org.springframework.security.core.context.SecurityContextImpl\x00\x00\x00\x00\x00\x00\x02\x08\x02\x00\x01L\x00\x0Eauthenticationt\x002Lorg/springframework/security/core/Authentication;xpsr\x00Oorg.springframework.security.authentication.UsernamePasswordAuthenticationToken\x00\x00\x00\x00\x00\x00\x02\x08\x02\x00\x02L\x00\x0Bcredentialst\x00\x12Ljava/lang/Object;L\x00\x09principalq\x00~\x00\x04xr\x00Gorg.springframework.security.authentication.AbstractAuthenticationToken\xD3\xAA(~nGd\x0E\x02\x00\x03Z\x00\x0DauthenticatedL\x00\x0Bauthoritiest\x00\x16Ljava/util/Collection;L\x00\x07detailsq\x00~\x00\x04xp\x01sr\x00&java.util.Collections$UnmodifiableList\xFC\x0F%1\xB5\xEC\x8E\x10\x02\x00\x01L\x00\x04listt\x00\x10Ljava/util/List;xr\x00,java.util.Collections$UnmodifiableCollection\x19B\x00\x80\xCB^\xF7\x1E\x02\x00\x01L\x00\x01cq\x00~\x00\x06xpsr\x00\x13java.util.ArrayListx\x81\xD2\x1D\x99\xC7a\x9D\x03\x00\x01I\x00\x04sizexp\x00\x00\x00\x0Ew\x04\x00\x00\x00\x0Esr\x00(com.mycomp.myauth.core.authority.ZempotRoleu\xAB\xE9\xDF\xD7Cfr\x02\x00\x01L\x00\x04rolet\x00\x12Ljava/lang/String;xr\x00-com.mycomp.myauth.core.authority.AuthorityEntity\xEB\xC1\x0FIJ~a\x06\x02\x00\x04L\x00\x0EcatalogSupportt\x00\x13Ljava/lang/Boolean;L\x00\x0DcontextEntityt\x00+Lcom/zempot/tes/core/context/ContextEntity;L\x00\x0Bdescriptionq\x00~\x00\x0FL\x00\x08identityt\x00\x13Ljava/lang/Integer;xpsr\x00\x11java.lang.Boolean\xCD r\x80\xD5\x9C\xFA\xEE\x02\x00\x01Z\x00\x05valuexp\x00sr\x00=com.mycomp.myauth.core.context.ContextEntity$SimpleContextEntityG\x096&~n;\x81\x02\x00\x00xr\x00)com.mycomp.myauth.core.context.ContextEntity\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x03L\x00\x0Bdescriptionq\x00~\x00\x0FL\x00\x02idq\x00~\x00\x13L\x00\x04nameq\x00~\x00\x0Fxpt\x00\x10TES \xEA\xB4\x80\xEB\xA6\xAC ADMINsr\x00\x11java.lang.Integer\x12\xE2\xA0\xA4\xF7\x81\x878\x02\x00\x01I\x00\x05valuexr\x00\x10java.lang.Number\x86\xAC\x95\x1D\x0B\x94\xE0\x8B\x02\x00\x00xp\x00\x00\x00\x0Dt\x00\x03test\x00\x16TES:\xEC\x8B\x9C\xEC\x8A\xA4\xED\x85\x9C\xEA\xB4\x80\xEB\xA6\xAC\xEC\x9E\x90sq\x00~\x00\x1B\x00\x00\x00\x14t\x00\x06systemsr\x00<com.mycomp.myauth.core.authority.SSOAdminContextAuthorityEntity\xCFU\x83K\x92+(!\x02\x00\x01L\x00\x0DtargetContextt\x003Lcom/zempot/tes/core/context/TesAdminContextEntity;xq\x00~\x00\x10q\x00~\x00\x16q\x00~\x00\x19t\x00\x16TES:\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4CMSsq\x00~\x00\x1B\x00\x00\x00\x0Asr\x001com.mycomp.myauth.core.context.TesAdminContextEntity\x00\x00\x00\x00\x00\x00\x00\x02\x02\x00\x03L\x00\x0DcontextEntityq\x00~\x00\x12L\x00\x0BdisplayTextq\x00~\x00\x0FL\x00\x02idq\x00~\x00\x13xpsq\x00~\x00\x17t\x00\x12\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4CMSsq\x00~\x00\x1B\x00\x00\x00\x0Bt\x00\x07mop_cmst\x00\x12\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4CMSq\x00~\x00+sq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x18TES:EPOCH\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4q\x00~\x00\x1Dsq\x00~\x00'sr\x00:com.mycomp.myauth.core.context.ContextEntity$SubContextEntity\x03\xB2\xA3\x14\xEC\xD6\xA9\xAD\x02\x00\x01L\x00\x0BrootContextq\x00~\x00\x12xq\x00~\x00\x18t\x00\x15epoch:\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4sq\x00~\x00\x1B\x00\x00\x00\x05t\x00\x09epoch_mopsq\x00~\x00\x17t\x00\x09EPOCH CMSsq\x00~\x00\x1B\x00\x00\x00\x07t\x00\x05epocht\x00\x15EPOCH_\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4q\x00~\x004sq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x12TES:EPOCH\xEC\xB9\xB4\xEC\xA7\x80\xEB\x85\xB8sq\x00~\x00\x1B\x00\x00\x00\x0Esq\x00~\x00'sq\x00~\x001t\x00\x0Cepoch:\xEC\x8A\xAC\xEB\xA1\xAFsq\x00~\x00\x1B\x00\x00\x00\x06t\x00\x0Aepoch_slotq\x00~\x006t\x00\x15EPOCH_\xEA\xB8\x80\xEB\xA1\x9C\xEB\xB2\x8C\xEC\x8A\xAC\xEB\xA1\xAFq\x00~\x00Asq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x14TES:WINGER_\xEA\xB3\xA0\xEC\x8A\xA4\xED\x86\xB1sq\x00~\x00\x1B\x00\x00\x00\x10sq\x00~\x00'sq\x00~\x001t\x00\x12\xEC\x9C\x88\xEC\xA0\x80:PC\xEA\xB3\xA0\xEC\x8A\xA4\xED\x86\xB1sq\x00~\x00\x1B\x00\x00\x00\x03t\x00\x0Dwinger_gostopsq\x00~\x00\x17t\x00\x06\xEC\x9C\x88\xEC\xA0\x80sq\x00~\x00\x1B\x00\x00\x00\x01t\x00\x06wingert\x00\x10WINGER_\xEA\xB3\xA0\xEC\x8A\xA4\xED\x86\xB1q\x00~\x00Jsq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x16TES:\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xEB\xA7\x9E\xEA\xB3\xA0CMSsq\x00~\x00\x1B\x00\x00\x00\x0Csq\x00~\x00'sq\x00~\x00\x17t\x00\x15\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xEA\xB3\xA0\xEC\x8A\xA4\xED\x86\xB1CMSq\x00~\x00St\x00\x07mog_cmst\x00\x12\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xEB\xA7\x9E\xEA\xB3\xA0CMSq\x00~\x00Ssq\x00~\x00"q\x00~\x00\x16q\x00~\x00\x19t\x00\x11TES:WINGER_\xED\x8F\xAC\xEC\xBB\xA4sq\x00~\x00\x1B\x00\x00\x00\x0Fsq\x00~\x00'sq\x00~\x001t\x00\x0F\xEC\x9C\x88\xEC\xA0\x80:PC\xED\x8F\xAC\xEC\xBB\xA4sq\x00~\x00\x1B\x00\x00\x00\x02t\x00\x0Cwinger_pokerq\x00~\x00Lt\x00\x0DWINGER_\xED\x8F\xAC\xEC\xBB\xA4q\x00~\x00_sr\x00-com.mycomp.myauth.core.authority.SimpleAuthority\x01\x9D[\xE9\x9C\xFE\x9Dt\x02\x00\x03L\x00\x04authq\x00~\x00\x0FL\x00\x07projectq\x00~\x00\x0FL\x00\x07serviceq\x00~\x00\x0Fxq\x00~\x00\x10sq\x00~\x00\x15\x01q\x00~\x00]t\x00\x0F\xEC\x9C\x88\xEC\xA0\x80pokerUsersq\x00~\x00\x1B\x00\x00\x00\x11t\x00\x09pokerUserppsq\x00~\x00bq\x00~\x00\x16q\x00~\x00]t\x00\x0E\xEC\x9C\x88\xEC\xA0\x80pcpUsdersq\x00~\x00\x1B\x00\x00\x00\x15t\x00\x08pcp_userppsr\x00-com.mycomp.myauth.core.authority.LegacyAuthority\xCBqA\x12\x8D;)$\x02\x00\x03L\x00\x07projectq\x00~\x00\x0FL\x00\x04roleq\x00~\x00\x0FL\x00\x07serviceq\x00~\x00\x0Fxq\x00~\x00\x10q\x00~\x00\x16q\x00~\x00)t\x00#\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4 \xEC\x9D\xBC\xEB\xB0\x98\xEC\x9C\xA0\xEC\xA0\x80 \xEA\xB6\x8C\xED\x95\x9Csq\x00~\x00\x1B\x00\x00\x00\x16t\x00\x03NMPt\x00\x04USERt\x00\x03CMSsq\x00~\x00lq\x00~\x00\x16q\x00~\x00)t\x00 \xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4 \xEA\xB4\x80\xEB\xA6\xAC\xEC\x9E\x90 \xEA\xB6\x8C\xED\x95\x9Csq\x00~\x00\x1B\x00\x00\x00\x18t\x00\x03NMPt\x00\x05ADMINt\x00\x03CMSsq\x00~\x00bq\x00~\x00\x16q\x00~\x00)t\x00&\xEB\xAA\xA8\xEB\xB0\x94\xEC\x9D\xBC\xED\x8F\xAC\xEC\xBB\xA4 \xEA\xB3\xA0\xEA\xB8\x89\xEA\xB4\x80\xEB\xA6\xAC\xEC\x9E\x90 \xEA\xB6\x8C\xED\x95\x9Csq\x00~\x00\x1B\x00\x00\x00\x19t\x00\x14NMP_CMS_ADMIN_MASTERppsq\x00~\x00bq\x00~\x00\x16sq\x00~\x00\x17t\x00\x15\xED\x85\x9C\xED\x94\x8C\xEB\xA6\xBF\xED\x94\x84\xEB\xA1\x9C\xEC\xA0\x9D\xED\x8A\xB8q\x00~\x00 t\x00\x08templatet\x00\x0D\xED\x83\xAC\xED\x94\x8C\xEB\xA6\xBFUSERsq\x00~\x00\x1B\x00\x00\x00\x1At\x00\x04userppsq\x00~\x00bq\x00~\x00\x16q\x00~\x002t\x00\x10EPOCH CMS \xEA\xB6\x8C\xED\x95\x9Csq\x00~\x00\x1B\x00\x00\x00\x1Ct\x00\x0Bmpoker_userppxq\x00~\x00\x0Dsr\x00Horg.springframework.security.web.authentication.WebAuthenticationDetails\x00\x00\x00\x00\x00\x00\x02\x08\x02\x00\x02L\x00\x0DremoteAddressq\x00~\x00\x0FL\x00\x09sessionIdq\x00~\x00\x0Fxpt\x00\x0F0:0:0:0:0:0:0:1pt\x00\x04jhunq\x00~\x00\x8B

위 데이터를 기준으로 보면, 스프링 시큐리티 모듈(SPRING_SECURITY_CONTEXT)에서 생성하고 사용하는 속성이다. 값으로는 계정의 권한 정보 등을 담고 있다. 

#### spring.session.sessions.expires

스케줄러에 의해 세션이 관리가 되지만, 스케줄러 외의 세션에 관심사가 있는 주체가 세션의 유효시간을 체크해야할 때 사용하는 키이다.

2개가 공존하는 것은 스케줄러와의 커플링을 제거하기 위해서이다.  스케줄러 외의 주체가 세션이 만료되었는지를 확인하려면 키를 검색하면 된다.

- spring:session:sessions:expires:f14f10d2-4c9a-4e6a-91ec-f84bd693670b

    - null
