
Azure 서비스 버스를 다루었던 경험을 기록한다.

## 짚고 넘어갈 점

### 용어의 정리

#### 메세징 브로커

일반적으로 아무생각없이 얘기하는 메세지 큐에 해당한다. 사실 메세지 큐만 있는 것이 아니라, 메세지 토픽도 있다. 2개의 차이는 유니캐스팅 vs 브로드캐스팅(멀티캐스팅) 차이이다.

MSA 해봤어요 라 얘기할 때, 메세지 큐를 썻습니다 ㅎㅎ 하는 사람은 경험이 없는 것이다, 메세지 브로크 시스템(플랫폼)을 써봤습니다 라 얘기해야한다.

왜냐면 토픽도 큐도 모두 둘다 사용하기 때문이다.

이유는 메세지 큐는 유니캐스트 기반의 라운드로빈 식의 스레드 풀처럼 하나의 메세지를 하나의 메세지 수신자(또는 구독자, 또는 워커)가 받아가면 메세지는 삭제되는 개념이고,

메세지 토픽은 디자인패턴의 옵저버 패턴 처럼 메세지가 수신되었을 때 감지를 위한 옵저버(또는 구독자, 또는 워커) 들에게 모두 메세지를 복사해서 던져주는 브로드캐스팅 개념이다.

아래 이미지를 참고하자

https://i.stack.imgur.com/B6H90.png


#### 큐

http://activemq.apache.org/how-does-a-queue-compare-to-a-topic.html

위에서 얘기했던 것처럼 큐의 경우는 아래의 시나리오에 사용된다.

- 특정 이벤트 (또는 작업)에 대해서 여러 인스턴스들이 순차적으로(또는 라운드로빈, 또는 랜덤) 이벤트를 처리해야하는 경우는 메세지 큐를 사용해야 한다.

#### 토픽

http://activemq.apache.org/how-does-a-queue-compare-to-a-topic.html

- 특정 이벤트를 관심있는 모든 이가 동시에(사실 거의 동시에) 이벤트를 수신해야하는 경우, 즉 브로드캐스팅이 필요한 경우

- 특정 이벤트를 위의 예시처럼 브로드캐스팅 되지만, 이벤트를 수신하고 이벤트가 관심있는 경우만 처리해야하는 경우, 즉, 멀티캐스팅으로 특정 이벤트만 필터링하고 싶은 경우



Azure 에서도 JMS 의 큐와 토픽과 같은 개념으로 설계가 되어있다. 

내 경험상 레빗엠큐와 조금 차이가 있다면, 토픽에 수신하고 싶은 구독자를 등록하는 과정이 꽤 번거롭고 복잡하다.

레빗엠큐는 특정 토픽 이름만 알면 자유롭게 구독자로 등록할 수 있다. 나는 UUID로 랜덤 문자열을 뽑아서 등록하게 했었다.

Azure 에서는 이 과정이 번거롭다. Azure Template 이라는 것을 통해 하드웨어 서버 OS 단에서 스크립트를 실행해서 등록하는 식의 과정이 있다.

파이썬의 경우에는 동적으로 등록하는 예제가 있던데, 자바의 경우는 어쩐지 모르겠다. 있을 거 같은데 좀 불편하더라.







