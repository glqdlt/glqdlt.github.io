## summary

C#과 달리 자바의 경우 AZURE 프로비저닝 지원하는 폭이 매우 적음. 아래는 웹앱 생성시 자바 기반의 웹앱 구성시의 캡쳐.



결국 자바는 별도로 구성해야하는 이슈를 마주함. 다행히 MS에서 java agent 를 제공해주어서, 각 기능마다 별도 구성을 안하고 one step 구성으로 c#처럼 모두 적용할수 있어서 이 방향으로함.

다만 이 AGENT가 beta 버전이여서 다소 불안정한 모습을 보여서 장애가 발생하면서 오히려 손이 많이가는 상황.

정석대로 별도로 구성하는게 맞다고 느꼈고, 이에 대한 기록.

 

AZURE INSIGHT 라 함은 아래 2가지를 합쳐서 가르키는 경향이 있음으로, 꼭 구분해서 이해하길 바람.

- 로그 중앙저장
- 네트워크 메트릭

### 로그 중앙 저장 (Azure Insight > 모니터링 > 로그)


말그대로 우리가 일반적으로 이해하는, 콘솔 로그 출력, 파일 로그 출력 그걸 의미함. 더 쉽게 말하면 로그백, 로그4j 같은 로거들을 의미함.

필자의 경우 약 4년전에 엘라스틱서치로 구성하는 방향으로 했었음, 당시 방안은 아래처럼 2가지였음

외부 저장소에서 APP 로그에 직접 접근해서 크롤링 해가는 방법

APP에서 스스로 외부 저장소로 직접 발송해주는 방법

필자는 여러 사정으로 첫번째 방안으로 했었음, 이 경우 많은 기술적 한계가 존재함.

AZURE INSIGHT 는 로그 저장소의 역활도함, 이 경우 위의 2가지 방안 중 아래방안으로 APP 에서 직접 로그 저장소에 발송해야함

다행히, MS에서 SLF4J 아답터에 연동되는 LOGBACK, LOG4J2 등의 각종 로거들을 구현한 걸 공개해놓음. 이거 그냥 쓰면 됨. 아래를 참고

https://docs.microsoft.com/ko-kr/azure/azure-monitor/app/java-trace-logs

 

### 네트워크 매트릭 (Azure Insight > 모니터링 > 매트릭 )
웹 서버를 운영하면, 이 서버와 네트워크적으로 연결된 요소들의 흐름을 시각화 하고 싶어함.

이에 해당하는 개념임, 메트릭이란 뜻은 단순히 특정 프로세스나 흐름을 연결할수있는 정보라는 의미임, 보통 통계에서 얘기 많이됨.

네트워크 매트릭은 결국 네트워킹의 흐름을 보여주는 정보라는 것이고, 쉽게 이해하려면 HTTP SESSION 기준  으로 HTTP SESSION이 어디까지 도달했는지를 의미하는 걸로 이해하면됨.

네트워크 포톨리지 처럼 서버 노드 간의 관계도 간접적으로 참조할수는 있으나, 어디까지 HTTP SESSION이 어디까지 흘러갔나를 보는 관점으로 봄.

자바에서는 WAS의 입출력(reqeust, response) 에 MS에서 인터셉팅 역활을 하는 필터를 연동시켜주어야함.

라이브러리를 MS에서 제공하고 있고 이에대한 가이드 문서는 아래와 같음.

https://docs.microsoft.com/ko-kr/azure/azure-monitor/app/java-get-started?tabs=maven
