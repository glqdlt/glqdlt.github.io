---
layout: post
title:  "도커와 자바"
author: "glqdlt"
comments : true
---

팀에서 클라우드로의 전환을 준비하고 있다. 이 과정에서 필연적으로 기존 물리적 서버 기반에서 컨테이너 기반의 논리적인 환경으로 어플리케이션 빌드와 배포를 변경해야 한다. 이 과정을 기록해본다.

# 레퍼런스
https://github.com/spotify/docker-maven-plugin#use-a-dockerfile



# 배포 시나리오

1. maven 에 도커 빌드 구성을 준비한다.
2. mvn install 명령으로는 도커 트리거가 되지 않는다.
3. 젠킨스에 도커를 설치한다. 젠킨스도 도커기반이기 때문에 이런 환경을 docker in docker 라고한다.
4. 젠킨스에 빌드트리거나 빌드 유발은 기존과 똑같다. 단지 빌드 수행 커맨드가 'mvn docker' 로 변경 될 뿐 이다.
5. 여기서 후처리를 sonatype/nexus 에 push 하게 한다던지, push 되면 트리거 되어서 배포 서버로 보낸다던지는 자유이다.
6. 나는 기본적으로 docker plugin 에서  DOCKER_HOST=tcp://<host>:2375 로 설정되어 있다면 host:2375 도커데몬으로 바로 붙어서 작업할 수 있는 걸 응용하려 한다.


