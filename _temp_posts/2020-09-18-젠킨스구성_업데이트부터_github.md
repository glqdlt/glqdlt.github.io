---
layout: post
title:  "인덱싱 없는 데이터의 조회"
author: "glqdlt"
comments : true
---


젠킨스 구성

젠킨스의 war 가 구성되어 있는 곳


> docker exec -it --user root jenkins /bin/bash

jenkins 2.60 --> 2.138.1

> /usr/share/jenkins/jenkins.war

> /var/jenkins_home

rm -f /usr/share/jenkins/jenkins.war

cp /var/jenkins_home/jenkins.war /usr/share/jenkins/jenkins.war


chown jenkins:root jenkins.war

docker stop jenkins

docker start jenkins



각 빌드 트리거의 설정

빌드를 원격으로 유발

이건 특정 Restful API를 호출해서 원격에서 빌드하겠다 하는 내용이다.

Authentication Token 에 내가 마음대로 등록하고, 아래 스샷에도 나온 것처럼

> http://님들젠킨스서버주소/job/님들프로젝트이름/build?token=님이설정한토큰

을 호출하면 빌드를 원격으로 시작하게 할 수 있다.

단, 요놈은 내부망(Git도 내부에 있고)에서 쓸 때나 쓸법한 거다. 그도 그럴 것이 요놈은 Jenkins 의 보안 설정이 '미인증자(Anonymounse)도 접근이 가능' 이어야할 때만 사용할 수 있다. 이게 안 되어있으면 403 Response Code와 함께 인증을 요구하는 에러를 볼 수 있다.

이걸 쓸만한 시나리오는 Yona 와 같은 사내 내부 repository 관리하는 application 을 개발해서 거기에 call 하게 하는 기능을 만든다던지 할 때나 쓸법하다.


GitHub hook trigger for GITScm polling

이 설정의 경우 jenkins -> github 를 바라보는 모양새가 된다. github 플러그인만 잘 깔려있다면 소스 코드 관리의 repositories 에 credentional 설정만 잘 되어 있다면 jenkins 에서 알아서 github 의 push notification 을 폴링해서 빌드하게 된다.

Build when a change is pushed to GitLab.

이건 gitlab plugin을 깔았을 때 쓸수있는건데, gitlab -> jenkins 형태가 된다. gitlab 에서 push event가 발생하면 jenkins 의 webhook 으로 push 를 해라고 알리게 되는 꼴이다.

Build when a change is pushed to GitLab. GitLab webhook URL: http://님들젠킨스서버주소/project/님들프로젝트이름

문구를 보면 알겠지만, jenkins webhook 의 url 이 있다.

이 플러그인의 고급을 눌러서 Secret token 라벨을 보면 시크릿 토큰을 generate어서 api 호출 시에 인증을 요구하게 할 수 있다.

Secret token 으로 쓸 괴상망칙한 토큰을 등록하고, gitlab 의 project 에서 webhook 설정을 이 jenkins webhook url 과 Secret token 을 등록 해주면 된다.


slack notification plugin

빌드 후 조치에서 Slack Notifications 를 활성화하고 고급 설정을 눌러 slack webhook 을 등록해주면 된다.

Slack > Administration > Manage Apps

를 들어가서 (Jenkins CI 플러그인이 사전에 설치되어 있어야 한다.)

Add Congifiguration 를 누르고

1. 알림을 알릴 채널을 정한다.

2. Step 에 맞는 내용을 숙지하다가, 아래 Step3 에 적혀있는 Webhoo url 을 기억한다.




# Slack 에서 채팅하듯이 빌드 시켜버리기

Build Authorization Token Root Plugin 깔아야 한다.

이유는 위에 설명했듯이 원격에서 빌드 트리거를 하려면 보안 설정을 약하게 해야하는 데, 이를 하지 않고도 할 수 있게 위해서이다.

기존에 만들어뒀던 COPY ITEM 을 이용해서 NEW TIME 을 만든다.

여기에는 매개변수를 받도록 하고, 이를 GET parameter 로 넘기게 할 것이다.

그리고 바라보는 branch를 tag_head 로 바라볼수 있도록 아래처럼 처리한다.

최종 파라미터는 아래와 같다.


http://너님들의젠킨스주소/buildByToken/buildWithParameters?job=프로젝트이름&token=토큰이름&head=헤드넘버링

자 postman 으로 하던지, 브라우저 에 직접 처보던지 해보자, 잘 동작한다.



이제 남은 것은 이를 슬랙에 적용할 'Bot' 을 만들던지, request 를 대행해 어플리케이션을 직접 만들어주던가 하면 된다.

[공식 슬랫 api](https://api.slack.com/community)

[슬랙봇만든후기](https://brunch.co.kr/@sungi-kim/43)

[https://dzone.com/articles/make-slack-bots-in-java-in-minutes](https://dzone.com/articles/make-slack-bots-in-java-in-minutes)