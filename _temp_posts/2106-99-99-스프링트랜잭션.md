---
layout: post
title:  "스프링트랜잭션"
author: "glqdlt"
---

최근에 사내에 Mysql Replication 을 구성해서 사용하게 되었습니다. 기존에 Master 에 모든 CRUD 를 모두 행하던 코드들을 이제 M/S 에 맞게 CUD / R 로 나누어서 처리해주어야 합니다.

M / S 데이터소스의 분기 처리는 스프링의 abstractroutingdatasource 키워드로 접근해서 작업하면 될 것이라 생각했습니다.

문제는 @Transactional 로 선언 된 메소드 단위에서 read 는 slave 에서 읽어오고, update 구문은  master 에 처리되는 과정을 깔끔하게 처리하고 싶은데, 기초 지식이 부족해서 가늠이 안 잡혀서 공부를 시작하게 되었습니다.


원하는 구성은 아래의 구성입니다.

- 부모 트랜잭션
    - 자식 트랜잭션(select)
    - 자식 트랜잭션(update)
    - 자식 트랜잭션(select)


|속성|설명|예|
|----|----|----|
|isolation|트랜잭션의 원자성(isolation)을 처리|@Transactional(isolation=Isolation.DEFAULT)|
|propagation|트랜잭션 전파 규칙을 정의|@Transactional(propagation=Propagation.REQUIRED)|
|readOnly|트랜잭션을 읽기 전용으로 설정|@Transactional(readOnly = true)|
|rollbackFor|특정 Exception 에 대해서 rollback 할 지 설정|	@Transactional(rollbackFor=Exception.class)|
|noRollbackFor|특정 Exception 에 대해서 rollback 을 무시 할 지 설정 |	@Transactional(noRollbackFor=Exception.class)|
|timeout|지정한 시간 내에 수행이 완료되지 않은 경우 rollback|@Transactional(timeout=10)|


[스프링만의 독특한 트랜잭션 적용 비법은?](http://egloos.zum.com/springmvc/v/498979)
[스프링 트랜잭션](http://syaku.tistory.com/269)

[ref](http://whiteship.tistory.com/2143)