---
layout: post
title:  "protobug를 저장소에서 clone 해서 빌드"
author: "glqdlt"
---

A 메이븐 프로젝트에서는 B 레포지토리의 프로토파일을 의존하는 상황이다.

이 말은 A의 깃 레포지토리에서 B 깃 레포지토리를 찔러야 한다는 의미이다.

A 메이븐이 compile 단계가 될 때까지는 B 의 소스가 A 안에 존재해야한다.

이 말은 A를 빌드시켜주는 누군가에게 B의 소스를 가져오라는 명령을 해라는 말이다.

이걸 해줄 watcher 라는 이름의 데몬을 만들까도 

여러가지 고민을 많이 했는 데, 젠킨스에서 maven 파이프라인이 구축되어 있고, 

프로토버프가 컴파이 된 클래스를 아티팩트로 nexus 에서 관리하고 있기 때문에


maven exec plugin 을 쓰기로 했다.

이 친구가 하는 역활은 메이븐 빌드 시점에 외부 프로세스를 실행시키는 스텝을 하는 역활을 한다.

생각한 로직은 아래와 같다.

1. A 프로젝트 빌드 실행

2. mvn pull 이라는 명령에 의해 maven exec plugin 에서 개입

3. B 프로젝트에 git clone 하는 간단한 스크립트를 만듬

4. /src/proto/* 를 다 삭제

5. git clone

6. *.proto > /src/proto/ 로 카피

7. clone 한 프로젝트 다 삭제

8. 이후 프로토 버프 컴파일러 메이븐 플러그인 호출