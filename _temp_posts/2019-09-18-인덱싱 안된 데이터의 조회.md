---
layout: post
title:  "인덱싱 없는 데이터의 조회"
author: "glqdlt"
comments : true
---

# 들어가며

오래 된 로그를 특정한 필드의 정렬에 따라 날짜 별로 조회 해야하는 기능 요청사항이 생겼다. 요청 사항 자체는 대단한 것이 아니지만, 해결해야하는 환경 자체가 골 머리를 썩게 했다. 날짜 필드의 데이터가 인덱싱 되지 않은 60GB 의 대용량 테이블이었기 떄문.

나는 DB에 대해서 (특히 인덱싱) 정말 잼병이었기에, 팀장님께 도움을 요청했다. 해결 방법은 심플 하다. 해당 필드에 색인을 걸면 되는 것.
나름 해결 방안이 도출되자 마음은 안심이 되었는 데, 퇴근 길에 곰곰히 생각해보니 아래와 같은 문제를 직면할 거라 생각이 들었다.

1. Master - Slsave  (Replication) 모델 구조여서, Master 쪽에 색인은 Update 시에 성능 저하가 됨으로 Slave에만 색인을 걸어야하는 데 이것이 가능하며 또하 성능 상이나 운영 상에 문제가 없는 것인가?

2. x Mb 의 규모라면 걱정도 안하겠지만, 60GB 가 넘는 데이터를 색인 시에 어느 정도의 시간이 소모될 것인가? 이는 점검 시간하고 비례하게 된다.

3. 작업이 천재지변에 의해서 또는 개발자 실수로 실패 시에 롤백의 유무

이러한 고민 속에 다른 방안이 없는가를 생각해보았는 데, 예전 첫 회사에서 Mysql 을 Elastic Search 로 마이그레이션 했던 작업이 생각나서 
Elastic Search 로 해결해보고자 검색을 좀 했다.
결과는 아래와 같다.

1. Logstash 를 통한 Mysql to Pulling (Mysql -> Logstash -> El) : 해봤던 방법

2. go-mysql-elasticseach : 처음 알게 된 방법


## 1. logstash pulling

로그 수집기인 logstash 에 jdbc plugin 을 달아서 직접 Mysql 의 특정 테이블을 pulling 해오는 기법이다. 

## 2. go-mysql-elasticserch

Mysql 의 Replication 모델을 응요한 방법이다. Master 의 Bin log 를 Slave DB들이 바라보고 미러링 하는 것처럼, go-mysql-elastc-search 플러그인이 똑같은 행위를 하면서 Elastic Search 로 데이터를 밀어넣는다는 개념.


# 레퍼런스

https://blog.perfectacle.com/2017/11/06/mysql-to-elasitcsearch/

https://github.com/siddontang/go-mysql-elasticsearch

https://medium.com/@siddontang/how-to-sync-your-mysql-data-to-elasticsearch-ddae009243c1

https://blog.perfectacle.com/2017/11/06/mysql-to-elasitcsearch/




