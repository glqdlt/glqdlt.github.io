---
layout: post
title:  "웹 서비스와 암호화"
author: "glqdlt"
---


## 대칭키 와 비대칭키

대칭키와 비대칭키의 차이점은 암/복호화에 사용되는 키가 똑같냐 다르냐를 의미 한다. 대칭키는 말 그대로 암호화하고 복호화하는 데에 사용되는 키가 똑같다. 예를 들면 압축 프로그램에서 사용되는 암호 동작방식이 유사하다. 

비대칭키는 암호화하고 복호화하는 데에 사용되는 키가 다르다. 두 키 중에 하나는 암호화하는 데에만 사용이 되고, 다른 키는 복호화하는 데에만 사용이 된다. 보통 secret key 또는 private key 라는 것을 복호화에 사용하는 키로 사용하고, public key 라고 하는 외부에 알려져도 되는 키를 암호화하는 데에 사용한다. public key 기반 공개키 기반이라고 하는 것은 비대칭키 암호화의 범주에 속하고, 사실상 비대칭키 는 공개키 공개키는 비대칭키다 라고 할 만큼 더 포괄적이냐 구현관점이냐가 다른 사전적 의미만 다르고 실제 동작은 같다고 이해하면 된다.

공개키 알고리즘은 RSA 알고리즘이 대표적이다. 이름이 RSA 인 것은 만든 사람들의 이니셜을 따왔기 때문에 RSA(Ron <b>R</b>ivest, Adi <b>S</b>hamir, Leonard <b>A</b>dleman) 이다.

HTTPS 의 SSL(TLS) 통신은 대칭키와 비대칭키가 섞여 있는 쓰까쓰까 방식이다.

과정을 풀이하면 매우 흥미로워서 무릎을 탁 칠 수가 있다.

HTTPS 핸드쉐이킹

1. 웹서버가 유저 브라우저로 웹서버의 공개키를 전달

2. 유저 브라우저에서 웹 서버의 공개키를 받고, 해당 공개키의 출처인 인증서 발급소에 해당 키가 합법적인 키인지 확인

3. 유저 브라우저에서 암호화/복호화에 같이 사용할 대칭키를 생성함

4. 웹서버가 준 공개키로 대칭키를 암호화함

5. 유저 브라우저는 암호화된 대칭키를 웹서버로 전송함

6. 웹서버는 자신의 비밀키로 암호화된 대칭키를 해동함

7. 유저 브라우저와 웹 서버는 서로 같은 대칭키를 공유하게 되고, 자신의 패킷을 대칭키로 암호화해서 송신하고, 수신할 때에는 대칭키로 해독함.



## encrypt 와 encode

햇병아리 시절 예전 아웃소싱 회사와 협업을 할 때의 일화이다. 아웃소싱의 개발자의 소스를 인계 받아서 분석해야할 일이 있었는 데, 유저의 패스워드를 BASE64 로 인코딩 해놓은 걸 보고 이게 뭐냐고 질문을 한 적이 있다. 돌아온 대답은 '아~ 아직 연차가 작으셔서 잘 모르시는 가 보구나, 이거 암호화한거에요~ 암호화' 라고..

이 사실을 알게 된 팀장님은 당장 외주 회사를 교체해야한다고 노발대발 한 것은 비밀.

사전적 의미에서 두 개는 완전히 다르다. encrypt 는 암호화라는 의미이고, encode 는 인코딩이라 한다. 세종대왕님께서 인코딩이란 단어는 만든 적이 없다고 노발대발하겠지만, 인코딩이라는 개념은 정보의 형태나 형식을 변환하는 처리라고 말한다. 위키에 잘 설명되어있는 데, [부호화](https://ko.wikipedia.org/wiki/부호화) 형태나 형식을 표준화, 보안, 처리 속도 향상, 저장 공간 절약을 위해 다른 형태나 형식으로 변환하는 방식을 말한다.  한자로는 부호화라고 한다. 인코딩은 영상 편집에서도 자주 얘기 되는 데, 웹 서비스에서 문자 인코딩도 다를 바 없이 같은 개념을 가진다.

이미지/영상 편집에서 인코딩은 픽셀을 특정한 포맷으로 압축을 한다는 걸 의미 한다. 예를 들어 RAW 이미지 / 영상의 용량이 100MB 라면, 인코딩을 통해서 용량일 50MB 로 줄일 수 있다. 이미지/ 영상 편집에서 인코딩은 원본 영상과 유사한 화질로 떨어트리되 용량을 획기적으로 줄일 수 있는 알고리즘을 적용한다. JPEG 인코딩을 예로 들면, BMP 원본 이미지를 JPEG 로 바꿧을 때 10MB BMP 이 500kb JPEG 로 바뀌는 기적을 보여준다. 자세히 보면 JPEG 원본에 비해 살짝 흐릿하게 보이는 데, 원본 이미지 픽셀 데이터를 날려버리고 그와 유사한 데이터로 치환시켜버리기 때문이다. 예를 들어서 우리가 "가나다라마바사아" 라는 문자가 있다고 가정하고, JPEG 인코딩처럼 길이(용량)을 줄이는 알고리즘을 적용한다고 생각해보자. 우리는 2글자씩 글자를 그룹핑 하고, 원본 데이터를 의미하는 규칙을 정해서 압축을 시켜보자. '가나'는 '간',  '다라'는 '달', '마바'는 '맙', '사아' 는 '상' 이라고 줄여보았다. 보면 알겠지만, 1번째 글자는 원본을 쓰고 2번쨰 글자는 자음을 받침으로 땡겨버렸다. 이렇게 되면 '가나다라마바사아' 는 '간달맙상' 으로 8글자에서 4글자로 절반이나 줄일수 있게 된다. 설명이 어거지 갔지만 이해만을 위한 목적에서는 도움이 되리라 생각한다. 이러한 걸 encode, 부호화 라고 한다.

마찬가지로 웹 서비스에서 자주 등장하는 문자열 인코딩도 어떠한 규칙을 통해 문자로 해석하겠다고 하는 것을 의미 한다. 웹 서비스에서 인코딩이 중요한 것은, 현재는 UTF-8 유니코드를 통해 대부분의 OS 에서 지원을 하기에 만국 공통 문자 인코딩처럼 사용되지만, 과거에는 컴퓨터 마다 문자 인코드가 다 달라서 같은 문자를 얘기하더라도 각기 다르게 해석을 해버렸다. 

우리가 컴퓨터에서 보는 문자는 엄연히 따지고 보면 0과 1로 이루어진 BIT 데이터이다. 

'안녕' 이라는 문장을 A 컴퓨터에서는 0001 이라고 작성한다면, B 컴퓨터에서는 0020 라고 작성 한다. 똑같이 '잘가' 라는 문장은 A에서는 0020 B에서는 0001 이라고 쓰는 규칙이 있다.

이런 환경에서 A에서 0001  데이터를 B 에게 주었을 떄에는 '안녕'이 아니라 '작별'로 해석하게 된다. 인사도 건내기 전에 헤어지자는 의미로 해석되어버린다.

이런 문제 때문에 A에서 0001  데이터를 B에게 주면서, 이는 A에서 작성을 했어.. 또는 A의 문자인코딩으로 작성 된 데이터야 라고 표기를 해서 B에게 건내어 준다. B는 아~ 이게 A식으로 작성한거니깐 '작별' 이 아니라 '안녕' 이라고 해석해야 하는 구나로 이해하게 되는 것이다.


